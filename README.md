# Quake Log Summarizer - .NET

This repository contains a multiplatform C# console application that parses a [Quake III Arena](https://github.com/id-Software/Quake-III-Arena) server log to summarize matches statistics.

## Match Summary

The application reads a server log and prints a [JSON](https://www.json.org/) object that summarizes each match (not an JSON array contaning all matches summaries). This is a sample:

```json
{
  "game_2": {
    "players": [
      "Isgalamido"
    ],
    "total_kills": "0",
    "kills": {
      "Isgalamido": "0"
    }
  }
}
{
  "game_3": {
    "players": [
      "Isgalamido",
      "Dono da Bola"
    ],
    "total_kills": "11",
    "kills": {
      "Isgalamido": "-7",
      "Dono da Bola": "0"
    }
  }
}
```

| Field         | Description                                                                               |
|---------------|-------------------------------------------------------------------------------------------|
| `game_{index}`| A match name (generated by the application). Uses an one-based index                      |
| `players`     | All players' name that joined the match                                                   |
| `total_kills` | Total kills in the match (includes world's kills and suicides)                            |
| `kills`       | The match final score. The keys are the players' names and the values are the final score |

### Notes

1. A player may change his name during a match. This parser will show the output based on the last player's name inside a match (some players may ingress a match with a default name `UnnamedPlayer`).
2. Suicides are included on match total kills.
3. Suicides are ignored on player's score (neither increases nor decreases his kills).
4. Some matches may contain truncated log data (maybe due to a crash on the server). This application will still summarize these matches.

## Usage

### Dependencies

This application dependencies are divided into groups. Choose one of them to each group:
- Build
  - [.NET 5.0 SDK](https://dotnet.microsoft.com/download)
  - [Docker](https://www.docker.com/)
- Run tests:
  - [.NET 5.0 SDK](https://dotnet.microsoft.com/download)
- Run application:
  - [.NET 5.0 Runtime](https://dotnet.microsoft.com/download)
  - [Docker](https://www.docker.com/)

This is a multiplatform application. The following commands may be used on Linux or Windows operating systems.

### Building

#### Using .NET 5.0 SDK

```bash
[quake-log-summarizer-dotnet]$ dotnet build
```

#### Using Docker

```
[quake-log-summarizer-dotnet]$ docker build -t quake-log-summarizer .
```

### Running Tests

```bash
[quake-log-summarizer-dotnet]$ dotnet test
```

### Running Application

#### Using .NET 5.0 SDK

```bash
[quake-log-summarizer-dotnet]$ dotnet build/QuakeLogSummarizer.Application/Debug/QuakeLogSummarizer.Application.dll
```

#### Using Docker

```bash
[quake-log-summarizer-dotnet]$ docker run -p 0.0.0.0:5000:5000 bla
```

### Using API

The application's server hosts a REST API on default Kestrel port `5000`. The `https` and `ipv6` support are disabled.
The application generates a [Swagger](https://swagger.io/) JSON documentation:

`http://localhost:5000/swagger/v1/swagger.json`

The Swagger documentation is used to generate a friendly UI used to test requests:

`http://localhost:5000/swagger`

The Swagger documentation is used to generate a friendly documentation page using ReDoc:

`http://localhost:5000/docs`

Please refer to the links above to get the API documentation.

## Project Structure

This structure is organized as following:

- :file_folder: **build** - Directory created when building the source code. Stores all executables and temporary build objects.
- :file_folder: **src** - Contains the executable source code projects.
    - :file_folder: **QuakeLogSummarizer.Application** - Project containing the console application and dependency injection code.
    - :file_folder: **QuakeLogSummarizer.Core** - Project containing the application's core processing rules.
- :file_folder: **test** - Contains the executable source code projects.
    - :file_folder: **QuakeLogSummarizer.UnitTest** - Project containing tests that runs only with in memory objects.
- :page_facing_up: **Directory.Build.Props** - File containing common build specifications. Avoids duplicated code on `csproj` files.
- :page_facing_up: **QuakeLogSummarizer.sln** - Solution file.


## TODO List

The following may be future enhancements:

- Improve Readme.
- Improve application JSON response to include all player's name inside a match.
- Warn when a match log is truncated.
- Change match summary object to improve integrations (read the current object may be painful).
- Extract more useful information from log messages.

## Contributing

TODO.
(Feel free to open issues and submit pull requests)
